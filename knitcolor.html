<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>毛線色卡管理工具</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 載入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Roboto+Mono:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .font-mono { font-family: 'Roboto Mono', monospace; }
        .bg-dashed-border {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='48' ry='48' stroke='%23D1D1D1' stroke-width='4' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, Fragment } = React;

        // 自定義 SVG 圖標組件，替代外部庫以避免報錯
        const Icon = ({ name, size = 24, className = "" }) => {
            const paths = {
                Search: <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />,
                Copy: <path d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />,
                Check: <path d="M5 13l4 4L19 7" />,
                Palette: <path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 110-2 1 1 0 010 2zm10 0a1 1 0 110-2 1 1 0 010 2zM12 18a5 5 0 01-5-5h10a5 5 0 01-5 5z" />,
                Moon: <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />,
                Sun: <Fragment><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></Fragment>,
                ShoppingBag: <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4H6zM3 6h18M16 10a4 4 0 01-8 0" />,
                Edit3: <path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z" />,
                Save: <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2zM17 21v-8H7v8M7 3v5h8" />,
                Download: <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />,
                Upload: <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" />,
                Plus: <path d="M12 5v14M5 12h14" />,
                Trash2: <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />,
                Info: <Fragment><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8" /></Fragment>,
                Grid: <Fragment><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7" /></Fragment>
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {paths[name]}
                </svg>
            );
        };

        const createEmptyYarns = () => {
            return Array.from({ length: 48 }, (_, i) => ({
                id: (i + 1).toString(),
                number: (i + 1).toString().padStart(2, '0'),
                hex: '#e5e5e5',
                category: '未分類',
                image: null
            }));
        };

        const YarnDisplay = ({ item, isEditing, onImageUpload }) => {
            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => onImageUpload(item.id, reader.result);
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="relative w-full h-44 flex items-center justify-center overflow-hidden bg-stone-50 transition-colors dark:bg-gray-900">
                    {item.image ? (
                        <img src={item.image} alt={item.number} className="w-32 h-32 object-contain drop-shadow-2xl transform rotate-6 transition-transform group-hover:scale-110 duration-500" />
                    ) : (
                        <div 
                            className="relative w-32 h-32 rounded-full shadow-inner transform rotate-12 flex items-center justify-center transition-transform group-hover:scale-110 duration-500"
                            style={{ 
                                backgroundColor: item.hex,
                                boxShadow: `inset 0 0 35px rgba(0,0,0,0.2), 10px 15px 35px rgba(0,0,0,0.25)`,
                                backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(255,255,255,0.1) 5px, transparent 6px)`
                            }}
                        >
                            <div className="w-6 h-24 bg-black/15 rounded-full blur-md"></div>
                        </div>
                    )}
                    {isEditing && (
                        <label className="absolute inset-0 bg-black/40 flex flex-col items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer">
                            <Icon name="Upload" className="text-white mb-2" />
                            <span className="text-white text-[10px] font-bold">更換照片</span>
                            <input type="file" className="hidden" accept="image/*" onChange={handleFileChange} />
                        </label>
                    )}
                    <div className="absolute -bottom-2 -right-2 w-20 h-20 border-b-8 border-r-8 border-black/5 rounded-br-[3rem] pointer-events-none"></div>
                </div>
            );
        };

        const YarnCard = ({ item, isEditing, copiedId, onCopy, updateItem, onDelete }) => {
            return (
                <div className="group relative flex flex-col bg-white dark:bg-gray-800 rounded-[3rem] shadow-sm hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 overflow-hidden border border-stone-100 dark:border-gray-700">
                    <YarnDisplay item={item} isEditing={isEditing} onImageUpload={(id, img) => updateItem(id, { image: img })} />
                    
                    {!isEditing ? (
                        <div className="absolute top-5 right-5 opacity-0 group-hover:opacity-100 transition-all transform translate-y-2 group-hover:translate-y-0">
                            <button onClick={() => onCopy(item.number, item.id)} className="p-3.5 bg-white/90 dark:bg-gray-800/90 backdrop-blur shadow-2xl rounded-2xl hover:bg-stone-900 hover:text-white dark:hover:bg-white dark:hover:text-black transition-all active:scale-90">
                                {copiedId === item.id ? <Icon name="Check" size={20} /> : <Icon name="Copy" size={20} />}
                            </button>
                        </div>
                    ) : (
                        <div className="absolute top-5 right-5">
                            <button onClick={() => onDelete(item.id)} className="p-3 bg-red-50 text-red-500 rounded-2xl hover:bg-red-500 hover:text-white transition-all shadow-lg">
                                <Icon name="Trash2" size={18} />
                            </button>
                        </div>
                    )}

                    <div className="p-8 flex flex-col items-center relative bg-white dark:bg-gray-800">
                        <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-stone-50 dark:bg-gray-950 rounded-full border-4 border-white dark:border-gray-800 shadow-inner"></div>
                        {isEditing ? (
                            <div className="w-full space-y-3 pt-2">
                                <div className="flex space-x-2">
                                    <input type="text" value={item.number} onChange={(e) => updateItem(item.id, { number: e.target.value })} className="w-1/2 text-center text-xl font-black bg-stone-100 dark:bg-gray-700 border-none rounded-xl py-2 dark:text-white" placeholder="編號" />
                                    <input type="color" value={item.hex} onChange={(e) => updateItem(item.id, { hex: e.target.value })} className="w-1/2 h-11 bg-stone-100 dark:bg-gray-700 border-none rounded-xl p-1 cursor-pointer" />
                                </div>
                                <select value={item.category} onChange={(e) => updateItem(item.id, { category: e.target.value })} className="w-full text-[10px] font-bold bg-stone-100 dark:bg-gray-700 border-none rounded-xl py-2 px-3 uppercase tracking-wider dark:text-gray-300">
                                    <option value="未分類">未分類</option>
                                    <option value="白黃色系">白黃色系</option>
                                    <option value="橘紅系列">橘紅系列</option>
                                    <option value="粉紫色系">粉紫色系</option>
                                    <option value="藍綠色系">藍綠色系</option>
                                    <option value="大地色系">大地色系</option>
                                    <option value="灰黑色系">灰黑色系</option>
                                </select>
                            </div>
                        ) : (
                            <Fragment>
                                <span className="text-6xl font-black text-stone-900 dark:text-white font-mono mb-3 tracking-tighter">{item.number}</span>
                                <div className="flex flex-col items-center space-y-3">
                                    <span className="text-[11px] font-black text-stone-400 dark:text-gray-500 uppercase tracking-[0.25em]">HEX: {item.hex}</span>
                                    <span className="px-4 py-1.5 bg-stone-100 dark:bg-gray-700 rounded-xl text-[10px] font-black text-stone-500 dark:text-gray-300 uppercase tracking-wider">{item.category}</span>
                                </div>
                            </Fragment>
                        )}
                    </div>
                </div>
            );
        };

        function App() {
            const [yarns, setYarns] = useState(createEmptyYarns());
            const [isEditing, setIsEditing] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [copiedId, setCopiedId] = useState(null);
            const [activeCategory, setActiveCategory] = useState('全部');

            const categories = ['全部', '白黃色系', '橘紅系列', '粉紫色系', '藍綠色系', '大地色系', '灰黑色系', '未分類'];

            const filteredYarns = useMemo(() => {
                return yarns.filter(yarn => {
                    const matchesSearch = yarn.number.includes(searchTerm) || yarn.hex.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesCategory = activeCategory === '全部' || yarn.category === activeCategory;
                    return matchesSearch && matchesCategory;
                });
            }, [yarns, searchTerm, activeCategory]);

            const updateItem = (id, updates) => {
                setYarns(prev => prev.map(y => y.id === id ? { ...y, ...updates } : y));
            };

            const deleteItem = (id) => {
                if (window.confirm('確定要刪除這張色卡嗎？')) {
                    setYarns(prev => prev.filter(y => y.id !== id));
                }
            };

            const exportData = () => {
                const dataStr = JSON.stringify(yarns, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', 'yarn_palette.json');
                linkElement.click();
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const json = JSON.parse(event.target.result);
                            setYarns(json);
                        } catch (err) { alert('讀取失敗，請確認檔案格式'); }
                    };
                    reader.readAsText(file);
                }
            };

            const handleCopy = (text, id) => {
                const dummy = document.createElement("textarea");
                document.body.appendChild(dummy);
                dummy.value = text;
                dummy.select();
                document.execCommand("copy");
                document.body.removeChild(dummy);
                setCopiedId(id);
                setTimeout(() => setCopiedId(null), 1500);
            };

            return (
                <div className={`min-h-screen transition-colors duration-500 ${isDarkMode ? 'dark bg-gray-950 text-white' : 'bg-stone-50 text-stone-900'}`}>
                    <header className="sticky top-0 z-50 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border-b border-stone-200/50 dark:border-gray-800">
                        <div className="max-w-[1400px] mx-auto px-8 h-28 flex items-center justify-between">
                            <div className="flex items-center space-x-5">
                                <div className="w-14 h-14 bg-stone-900 dark:bg-white rounded-[1.25rem] flex items-center justify-center shadow-2xl">
                                    <Icon name="ShoppingBag" className="text-white dark:text-stone-900" size={28} />
                                </div>
                                <div className="hidden sm:block">
                                    <h1 className="text-3xl font-black tracking-tighter uppercase leading-none">Yarn Editor</h1>
                                    <p className="text-[11px] text-stone-400 font-bold uppercase tracking-[0.4em] mt-1.5">Color Swatch Manager</p>
                                </div>
                            </div>
                            <div className="flex items-center space-x-4 flex-1 justify-end max-w-2xl">
                                <div className="relative flex-1 max-w-xs group">
                                    <Icon name="Search" className="absolute left-4 top-1/2 -translate-y-1/2 text-stone-400 group-focus-within:text-stone-900 transition-colors" size={20} />
                                    <input type="text" placeholder="搜尋編號..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-12 pr-6 py-4 rounded-[1.2rem] bg-stone-100 dark:bg-gray-800 border-none focus:ring-4 focus:ring-stone-200 dark:focus:ring-gray-700 text-sm font-bold transition-all dark:text-white" />
                                </div>
                                <button onClick={() => setIsEditing(!isEditing)} className={`flex items-center space-x-2 px-6 py-4 rounded-[1.2rem] font-black text-xs tracking-widest uppercase transition-all ${isEditing ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white dark:bg-gray-800 border border-stone-100 dark:border-gray-700 text-stone-600 dark:text-gray-300'}`}>
                                    {isEditing ? <Fragment><Icon name="Save" size={16} /> <span className="hidden md:inline">完成編輯</span></Fragment> : <Fragment><Icon name="Edit3" size={16} /> <span className="hidden md:inline">編輯模式</span></Fragment>}
                                </button>
                                <button onClick={() => setIsDarkMode(!isDarkMode)} className="w-14 h-14 rounded-[1.5rem] bg-white dark:bg-gray-800 shadow-sm border border-stone-100 dark:border-gray-700 flex items-center justify-center hover:bg-stone-50 dark:hover:bg-gray-700 transition-all active:scale-90">
                                    {isDarkMode ? <Icon name="Sun" size={24} /> : <Icon name="Moon" size={24} />}
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-[1400px] mx-auto px-8 py-16">
                        <div className="flex flex-col space-y-10 mb-20">
                            <div className="flex flex-wrap items-center justify-between gap-6">
                                <div className="flex flex-wrap gap-4">
                                    {categories.map(cat => (
                                        <button key={cat} onClick={() => setActiveCategory(cat)} className={`px-8 py-4 rounded-[1.5rem] text-[10px] font-black tracking-[0.2em] uppercase transition-all transform active:scale-95 ${activeCategory === cat ? 'bg-stone-900 text-white dark:bg-white dark:text-stone-900 shadow-2xl translate-y-[-4px]' : 'bg-white text-stone-400 dark:bg-gray-800 hover:bg-stone-100 dark:hover:bg-gray-700 border border-stone-100 dark:border-gray-700'}`}>{cat}</button>
                                    ))}
                                </div>
                                {isEditing && (
                                    <div className="flex items-center space-x-3">
                                        <label className="flex items-center space-x-2 px-6 py-4 bg-emerald-50 text-emerald-600 rounded-2xl cursor-pointer hover:bg-emerald-100 transition-colors">
                                            <Icon name="Upload" size={16} />
                                            <span className="text-[10px] font-black uppercase tracking-widest">匯入 JSON</span>
                                            <input type="file" className="hidden" accept=".json" onChange={importData} />
                                        </label>
                                        <button onClick={exportData} className="flex items-center space-x-2 px-6 py-4 bg-stone-900 text-white rounded-2xl hover:bg-stone-800 transition-colors"><Icon name="Download" size={16} /><span className="text-[10px] font-black uppercase tracking-widest">匯出設定檔</span></button>
                                    </div>
                                )}
                            </div>
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4 text-stone-400 bg-white dark:bg-gray-800 px-6 py-3 rounded-2xl border border-stone-100 dark:border-gray-700 shadow-sm">
                                    <Icon name="Info" size={18} className="text-stone-900 dark:text-white" />
                                    <span className="text-xs font-black tracking-wide uppercase">點擊右上方可切換編輯模式</span>
                                </div>
                                <div className="hidden md:flex items-center space-x-2 text-[10px] font-black uppercase text-stone-400">
                                    <Icon name="Grid" size={14} />
                                    <span>網格顯示模式</span>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-12">
                            {filteredYarns.map(yarn => (
                                <YarnCard key={yarn.id} item={yarn} isEditing={isEditing} copiedId={copiedId} onCopy={handleCopy} updateItem={updateItem} onDelete={deleteItem} />
                            ))}
                            {isEditing && (
                                <button onClick={() => setYarns([...yarns, { id: Date.now().toString(), number: '?', hex: '#e5e5e5', category: '未分類', image: null }])} className="flex flex-col items-center justify-center h-[500px] bg-dashed-border bg-stone-100/50 dark:bg-gray-800/30 rounded-[3rem] border-4 border-dashed border-stone-200 dark:border-gray-700 hover:bg-stone-100 dark:hover:bg-gray-800 transition-all text-stone-300 hover:text-stone-900 dark:hover:text-white">
                                    <Icon name="Plus" size={48} />
                                    <span className="mt-4 font-black uppercase tracking-[0.2em] text-xs">新增色卡</span>
                                </button>
                            )}
                        </div>
                    </main>

                    <footer className="py-40 text-center opacity-30">
                        <p className="text-[12px] font-black uppercase tracking-[0.6em]">Yarn Studio Management System &bull; v2.0</p>
                    </footer>

                    <div className={`fixed bottom-16 left-1/2 -translate-x-1/2 bg-stone-900 dark:bg-white text-white dark:text-stone-900 px-12 py-6 rounded-[2.5rem] shadow-2xl transition-all duration-500 z-[100] flex items-center space-x-5 ${copiedId ? 'opacity-100 translate-y-0 scale-100' : 'opacity-0 translate-y-24 scale-90 pointer-events-none'}`}>
                        <div className="w-4 h-4 bg-green-400 rounded-full animate-pulse"></div>
                        <span className="text-base font-black tracking-[0.2em] uppercase">編號已複製</span>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
